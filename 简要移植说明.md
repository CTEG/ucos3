---
tag : [ RTOS ]
category : [ TECH , 源码 ]
---


简要 uCOS-III 移植说明

要移植一款 RTOS 到自己的开发板首先要做到两点：

1. 大致理解操作系统各部分代码实现的功能；
2. 熟悉开发板 CPU 的各种特性。

掌握这两点后就可以进行系统移植了：理解系统代码含义就可以知道那些代码是和平台相关、需要修改，熟悉 CPU 特性就可以知道怎么修改平台相关代码。

## 1. uCOS-III 代码说明

以 Linux Simulation 版 uCOS 为例，它的代码结构如下：

```
├── Examples
│   └── POSIX
└── Software
   ├── uC-CPU
   │   └── Ports
   ├── uC-LIB
   └── uCOS-III
       ├── Ports
       └── Source
```

从目录结构来看，代码可以分为 4 部分：

1. Examples : Demo 程序，也是编写应用的例子程序；
2. uC-CPU : CPU 相关代码；
3. uC-LIB : Micrium 自己实现的 lib c 库代码；
4. uCOS-III : uCOS 内核代码。

简单来说，系统移植

- 首先要修改 uC-CPU 下的代码，包括类型定义（和 CPU 字长相关），硬件底层操作的实现（如 cache 、计数器、中断异常处理等），以及和编译器相关的部分（如编译器的特殊功能）;
- 然后修改 `uCOS-III/Ports` 下的代码，这部分是系统的底层操作，为了提高效率，部分是由汇编代码，包括任务切换和异常处理，以及和任务实现的细节（如任务栈创建）；
- 接下来就是通过修改系统的各项参数和宏开关来配置、裁剪 uCOS ，也就是修改 `Examples` 下的代码。

## 2. 移植过程

接下来以 Linux Simulation 版 uCOS 为例简要说明如何移植系统。

(to be continued)

### 2.1. 开发板特性（即 Linux 运行环境说明）

类型定义

cache

计时器

中断处理

编译器

### 2.2. 系统底层

任务切换

中断异常处理

### 2.3. 系统配置 

参数

宏开关（功能）
